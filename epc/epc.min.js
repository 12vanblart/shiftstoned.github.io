/*  Eternal Power Calculator - https://github.com/matt-kimball/epc  */
"use strict";function factorialSlow(n){var i,r;r=1;for(i=n;i>1;i-=1){r=r*i}return r}var factorialLookup={};function buildFactorialLookup(){var i;for(i=0;i<100;i+=1){factorialLookup[i]=factorialSlow(i)}}buildFactorialLookup();function factorial(n){if(n<100){return factorialLookup[n]}return factorialSlow(n)}function binomial(n,k){if(k>n){return 0}return factorial(n)/factorial(k)/factorial(n-k)}function makeInfluence(influenceString){var i,chr,digit,influence={power:0,fire:0,justice:0,primal:0,shadow:0,time:0,wild:0};for(i=0;i<influenceString.length;i+=1){chr=influenceString[i];if(chr.charCodeAt(0)>="0".charCodeAt(0)&&chr.charCodeAt(0)<="9".charCodeAt(0)){digit=Number(chr);if(influence.power>0){influence.power=influence.power*10+digit}else{influence.power=digit}}else if(chr==="F"){influence.fire+=1}else if(chr==="J"){influence.justice+=1}else if(chr==="P"){influence.primal+=1}else if(chr==="S"){influence.shadow+=1}else if(chr==="T"){influence.time+=1}else if(chr==="X"){influence.wild+=1}else{influence.makeError='Invalid influence: "'+influenceString+'"'}}influence.zero=function(){influence.power=0;influence.fire=0;influence.justice=0;influence.primal=0;influence.time=0;influence.shadow=0;influence.wild=0};influence.isEmpty=function(){if(influence.power>0){return false}if(influence.fire>0||influence.justice>0||influence.primal>0||influence.time>0||influence.shadow>0||influence.wild>0){return false}return true};influence.toString=function(){var str;if(influence.power>0){str=String(influence.power)}else{str=""}str=str+"F".repeat(influence.fire);str=str+"T".repeat(influence.time);str=str+"J".repeat(influence.justice);str=str+"P".repeat(influence.primal);str=str+"S".repeat(influence.shadow);str=str+"X".repeat(influence.wild);return str};influence.relevantTo=function(target){if(influence.power>0&&target.power>0){return true}if(influence.fire>0&&target.fire>0){return true}if(influence.justice>0&&target.justice>0){return true}if(influence.primal>0&&target.primal>0){return true}if(influence.shadow>0&&target.shadow>0){return true}if(influence.time>0&&target.time>0){return true}if(influence.wild>0){if(target.fire>0||target.justice>0||target.primal>0||target.shadow>0||target.time>0){return true}}return false};influence.add=function(count,other){influence.power+=count*other.power;influence.fire+=count*other.fire;influence.justice+=count*other.justice;influence.primal+=count*other.primal;influence.shadow+=count*other.shadow;influence.time+=count*other.time;influence.wild+=count*other.wild};influence.mask=function(target){var masked=makeInfluence("");if(target.power>0){masked.power=influence.power}if(target.fire>0){masked.fire=influence.fire}if(target.justice>0){masked.justice=influence.justice}if(target.primal>0){masked.primal=influence.primal}if(target.shadow>0){masked.shadow=influence.shadow}if(target.time>0){masked.time=influence.time}if(target.fire>0||target.justice>0||target.primal>0||target.shadow>0||target.time>0||target.wild>0){masked.wild=influence.wild}return masked};influence.equals=function(other){return other.power===influence.power&&other.fire===influence.fire&&other.justice===influence.justice&&other.primal===influence.primal&&other.shadow===influence.shadow&&other.time===influence.time&&other.wild===influence.wild};influence.satisfies=function(target){var unsatisfied=0;if(influence.power<target.power){return false}if(influence.fire<target.fire){unsatisfied+=target.fire-influence.fire}if(influence.justice<target.justice){unsatisfied+=target.justice-influence.justice}if(influence.primal<target.primal){unsatisfied+=target.primal-influence.primal}if(influence.shadow<target.shadow){unsatisfied+=target.shadow-influence.shadow}if(influence.time<target.time){unsatisfied+=target.time-influence.time}if(influence.wild<unsatisfied){return false}return true};return influence}function makeEternalCardInfo(id,influenceGenerated,influenceRequired){var card={id:id,influenceRequirements:[]};card.influenceGenerated=makeInfluence(influenceGenerated);if(card.influenceGenerated&&card.influenceGenerated.makeError){card.makeError=card.influenceGenerated.makeError}$.each(influenceRequired.split(","),function(index,str){var influence=makeInfluence(str);if(influence){if(influence.makeError){card.makeError=influence.makeError}else if(!influence.isEmpty()){card.influenceRequirements.push(influence)}}});return card}function makeEternalCardLibrary(cards){var library={cards:{}};function addCardInfo(line){var re,match,card,id,influenceGenerated,influenceRequired;line=line.trim();if(line.length<=0){return}re=/^(Set[0-9]+ #[0-9]+);(.*);(.*)$/;match=line.match(re);if(!match){library.makeError='Invalid card info: "'+line+'"';return}id=match[1];influenceGenerated=match[2].trim();influenceRequired=match[3].trim();card=makeEternalCardInfo(id,influenceGenerated,influenceRequired);if(card.makeError){library.makeError=card.makeError+' in "'+line+'"'}library.cards[id]=card}$.each(cards.split("\n"),function(index,line){if(library.makeError){return library}addCardInfo(line)});return library}function makeDrawCombinationIterator(deck,cardGroups,maxCards,influence){var iter,workingInfluence;iter={cardGroups:cardGroups,cardGroupCount:[],cardGroupInfluence:[],current:[],done:false};workingInfluence=makeInfluence("");function incrementCurrent(){var index,count;index=iter.current.length-1;while(index>=0){count=iter.cardGroupCount[index];iter.current[index]+=1;if(iter.current[index]<=count){return}iter.current[index]=0;index-=1}iter.done=true}function drawSatisfiesInfluence(){var i,groupInfluence,count;workingInfluence.zero();for(i=0;i<cardGroups.length;i+=1){groupInfluence=iter.cardGroupInfluence[i];count=iter.current[i];workingInfluence.add(count,groupInfluence)}return workingInfluence.satisfies(influence)}function currentCount(){var i,count;count=0;for(i=0;i<cardGroups.length;i+=1){count+=iter.current[i]}return count}iter.next=function(){while(!iter.done){incrementCurrent();if(currentCount()<=maxCards&&drawSatisfiesInfluence()){break}}if(iter.done){return{done:true}}return{value:iter.current.slice(),done:false}};$.each(cardGroups,function(index,value){var groupInfluence,count;iter.current.push(0);count=0;$.each(cardGroups[index],function(cardIndex,card){groupInfluence=card.influenceGenerated;count+=deck.cardCount[card.id]});iter.cardGroupCount.push(count);iter.cardGroupInfluence.push(groupInfluence)});return iter}function makeEternalDeck(cardlibrary,decklist){var deck={cardlibrary:cardlibrary,cards:[],cardNames:{},cardCount:{}};function addCardLine(line){var re,match,count,name,cardid,card,i;line=line.trim();if(line.length<=0){return}re=/^([0-9]+) (.+) \((Set[0-9]+ #[0-9]+)\)$/;match=line.match(re);if(!match){deck.makeError='malformed line: "'+line+'"';return}count=Number(match[1]);name=match[2];cardid=match[3];if(count>100){deck.makeError='too many cards: "'+line+'"';return}card=cardlibrary.cards[cardid];if(!card){deck.makeError='unknown card: "'+cardid+'"';return}for(i=0;i<count;i+=1){deck.cards.push(card)}deck.cardNames[card.id]=name;if(deck.cardCount[card.id]){count+=deck.cardCount[card.id]}deck.cardCount[card.id]=count}deck.listInfluenceRequirements=function(){var influenceDict,influenceList,cards;cards=deck.cards.slice();cards.sort(function(a,b){var infA,infB;infA=a.influenceRequirements[0];infB=b.influenceRequirements[0];if(!infA&&!infB){return 0}if(!infA){return-1}if(!infB){return 1}return infA.power-infB.power});influenceList=[];influenceDict={};$.each(cards,function(index,card){$.each(card.influenceRequirements,function(index,influence){var influenceStr,influencePair;influenceStr=influence.toString();influencePair=influenceDict[influenceStr];if(influencePair){influencePair[1].push(card);return}influencePair=[influence,[card]];influenceList.push(influencePair);influenceDict[influenceStr]=influencePair})});return influenceList};function listDrawCombinations(influence,maxCards){var relevantCards,cardGroups;relevantCards=[];$.each(Object.getOwnPropertyNames(deck.cardCount),function(index,id){var card;card=deck.cardlibrary.cards[id];if(card.influenceGenerated&&card.influenceGenerated.relevantTo(influence)){relevantCards.push(card)}});cardGroups=[];$.each(relevantCards,function(index,card){var foundGroup=false;$.each(cardGroups,function(index,group){var groupCard,groupInfluence,cardInfluence;if(foundGroup){return}groupCard=group[0];groupInfluence=groupCard.influenceGenerated.mask(influence);cardInfluence=card.influenceGenerated.mask(influence);if(groupInfluence.equals(cardInfluence)){group.push(card);foundGroup=true}});if(!foundGroup){cardGroups.push([card])}});return makeDrawCombinationIterator(deck,cardGroups,maxCards,influence)}function oddsForCombination(cardGroupCount,combination,drawCount){var odds,count,totalMatch,totalDeckMatch,deckCount,i;odds=1;totalMatch=0;totalDeckMatch=0;for(i=0;i<combination.length;i+=1){count=combination[i];deckCount=cardGroupCount[i];odds=odds*binomial(deckCount,count);totalDeckMatch+=deckCount;totalMatch+=count}odds=odds*binomial(deck.cards.length-totalDeckMatch,drawCount-totalMatch);odds=odds/binomial(deck.cards.length,drawCount);return odds}deck.drawOdds=function(drawCount,influence){var drawCombinations,combinationIter,odds;if(drawCount>=deck.cards.length){return 1}drawCombinations=listDrawCombinations(influence,drawCount);odds=0;while(true){combinationIter=drawCombinations.next();if(combinationIter.done){break}odds=odds+oddsForCombination(drawCombinations.cardGroupCount,combinationIter.value,drawCount)}return odds};deck.listPowerInfluenceSources=function(){var ret,used;ret=[];used={};$.each(deck.cards,function(index,card){var influence;if(used[card.id]){return}influence=card.influenceGenerated;if(!influence.isEmpty()){ret.push(card)}used[card.id]=true});return ret};$.each(decklist.split("\n"),function(index,line){if(deck.makeError){return}addCardLine(line)});return deck}"use strict";function drawPowerGraph(canvas,graphStyle,deck){var ctx,canvasWidth,canvasHeight,margin,graphCoord,fontSize,imgSize,influenceTurns,minValue,minDraws,maxDraws,horizontalMidlineStep,verticalMidlineStep,labels;margin=96;fontSize=20;imgSize=30;labels=[];canvasWidth=canvas.width();canvasHeight=canvas.height();canvas.attr("width",canvasWidth);canvas.attr("height",canvasHeight);ctx=canvas.get(0).getContext("2d");ctx.clearRect(0,0,canvasWidth,canvasHeight);graphCoord={left:margin,top:fontSize/2,right:canvasWidth-margin,bottom:canvasHeight-margin};function listComponentInfluences(influence){var part,components=[];if(influence.fire>0){part=makeInfluence("");part.fire=influence.fire;components.push(part)}if(influence.justice>0){part=makeInfluence("");part.justice=influence.justice;components.push(part)}if(influence.primal>0){part=makeInfluence("");part.primal=influence.primal;components.push(part)}if(influence.shadow>0){part=makeInfluence("");part.shadow=influence.shadow;components.push(part)}if(influence.time>0){part=makeInfluence("");part.time=influence.time;components.push(part)}return components}function listAllInfluenceTurns(){var componentPairs,ret;componentPairs={};ret=[];$.each(deck.cards,function(index,card){var components,turn;if(card.influenceRequirements.length<1){return}turn=card.influenceRequirements[0].power;if(turn<1){turn=1}components=listComponentInfluences(card.influenceRequirements[0]);$.each(components,function(index,component){var componentStr,componentPair,influenceTurn;componentStr=component.toString();componentPair=componentStr+","+String(turn);if(!componentPairs.hasOwnProperty(componentPair)){influenceTurn={influence:component,turn:turn};componentPairs[componentPair]=influenceTurn;ret.push(influenceTurn)}})});return ret}function listInfluenceTurns(){var componentTurns,ret;componentTurns={};$.each(listAllInfluenceTurns(),function(index,influenceTurn){var influenceStr,turn;influenceStr=influenceTurn.influence.toString();turn=influenceTurn.turn;if(componentTurns.hasOwnProperty(influenceStr)){if(turn<componentTurns[influenceStr]){componentTurns[influenceStr]=turn}}else{componentTurns[influenceStr]=turn}});ret=[];$.each(Object.keys(componentTurns),function(index,componentStr){var influenceTurn={influence:makeInfluence(componentStr),turn:componentTurns[componentStr]};ret.push(influenceTurn)});return ret}function drawLeftLabel(label,y){var drawX,drawY,textSize;textSize=ctx.measureText(label);drawX=graphCoord.left-textSize.width-fontSize;drawY=y+fontSize/2;ctx.fillText(label,drawX,drawY)}function drawBottomLabel(label,x){var drawX,drawY,textSize;textSize=ctx.measureText(label);drawX=x-textSize.width/2;drawY=graphCoord.bottom+2*fontSize;ctx.fillText(label,drawX,drawY)}function drawOutline(){var midline,frac,midpos;ctx.save();ctx.fillStyle=graphStyle.backgroundColor;ctx.beginPath();ctx.moveTo(graphCoord.left,graphCoord.top);ctx.lineTo(graphCoord.left,graphCoord.bottom);ctx.lineTo(graphCoord.right,graphCoord.bottom);ctx.lineTo(graphCoord.right,graphCoord.top);ctx.lineTo(graphCoord.left,graphCoord.top);ctx.fill();ctx.strokeStyle=graphStyle.interiorLineColor;midline=1-horizontalMidlineStep;while(midline>minValue){frac=(midline-minValue)/(1-minValue);midpos=graphCoord.bottom+frac*(graphCoord.top-graphCoord.bottom);ctx.beginPath();ctx.moveTo(graphCoord.left,midpos);ctx.lineTo(graphCoord.right,midpos);ctx.stroke();midline=midline-horizontalMidlineStep}midline=minDraws+verticalMidlineStep;while(midline<maxDraws){frac=(midline-minDraws)/(maxDraws-minDraws);midpos=graphCoord.left+frac*(graphCoord.right-graphCoord.left);ctx.beginPath();ctx.moveTo(midpos,graphCoord.top);ctx.lineTo(midpos,graphCoord.bottom);ctx.stroke();midline+=verticalMidlineStep}ctx.restore();ctx.beginPath();ctx.moveTo(graphCoord.left,graphCoord.top);ctx.lineTo(graphCoord.left,graphCoord.bottom);ctx.lineTo(graphCoord.right,graphCoord.bottom);ctx.lineTo(graphCoord.right,graphCoord.top);ctx.lineTo(graphCoord.left,graphCoord.top);ctx.stroke()}function addGraphLabels(){var midline,percent,x,y;midline=1;while(midline>minValue){y=graphCoord.bottom+(midline-minValue)/(1-minValue)*(graphCoord.top-graphCoord.bottom);percent=Math.round(100*midline);drawLeftLabel(String(percent)+"%",y);midline=midline-horizontalMidlineStep}midline=minDraws;while(midline<=maxDraws){x=graphCoord.left+(midline-minDraws)/(maxDraws-minDraws)*(graphCoord.right-graphCoord.left);drawBottomLabel("Turn "+String(midline-6),x);midline+=verticalMidlineStep}}function drawInfluenceIcons(influence,x,y){var text,i,img;if(influence.power>0){text=String(influence.power);ctx.fillText(text,x,y);x+=ctx.measureText(text).width}img=$("#icon-fire").get(0);for(i=0;i<influence.fire;i+=1){ctx.drawImage(img,x,y-imgSize,imgSize,imgSize);x+=imgSize}img=$("#icon-time").get(0);for(i=0;i<influence.time;i+=1){ctx.drawImage(img,x,y-imgSize,imgSize,imgSize);x+=imgSize}img=$("#icon-justice").get(0);for(i=0;i<influence.justice;i+=1){ctx.drawImage(img,x,y-imgSize,imgSize,imgSize);x+=imgSize}img=$("#icon-primal").get(0);for(i=0;i<influence.primal;i+=1){ctx.drawImage(img,x,y-imgSize,imgSize,imgSize);x+=imgSize}img=$("#icon-shadow").get(0);for(i=0;i<influence.shadow;i+=1){ctx.drawImage(img,x,y-imgSize,imgSize,imgSize);x+=imgSize}}function drawInfluenceCurve(influence,startDraw){var odds,oddsY,draws,x,y,fx,solidColor,transparentColor,gradient;ctx.save();if(influence.fire>0){solidColor="rgb(140, 23, 33)";transparentColor="rgba(140, 23, 33, 0)"}else if(influence.time>0){solidColor="rgb(181, 110, 7)";transparentColor="rgba(181, 110, 7, 0)"}else if(influence.justice>0){solidColor="rgb(33, 132, 33)";transparentColor="rgba(33, 132, 33, 0)"}else if(influence.primal>0){solidColor="rgb(15, 54, 118)";transparentColor="rgba(15, 54, 118, 0)"}else if(influence.shadow>0){solidColor="rgb(93, 28, 154)";transparentColor="rgba(93, 28, 154, 0)"}fx=(startDraw-minDraws)/(maxDraws-minDraws);x=graphCoord.left+fx*(graphCoord.right-graphCoord.left);gradient=ctx.createLinearGradient(x,0,x+canvasWidth,0);gradient.addColorStop(0,solidColor);gradient.addColorStop(1,transparentColor);ctx.strokeStyle=gradient;ctx.beginPath();ctx.lineWidth=5;for(draws=startDraw;draws<=maxDraws;draws+=1){odds=deck.drawOdds(draws,influence);oddsY=(odds-minValue)/(1-minValue);fx=(draws-minDraws)/(maxDraws-minDraws);x=graphCoord.left+fx*(graphCoord.right-graphCoord.left);y=graphCoord.bottom+oddsY*(graphCoord.top-graphCoord.bottom);if(draws===minDraws){ctx.moveTo(x,y)}else{ctx.lineTo(x,y)}}ctx.stroke();ctx.restore()}function drawInfluenceLabel(influence,pos){var x,y,iconSize;iconSize=imgSize*influence.toString().length;x=pos.x-iconSize/2;y=pos.y+imgSize/2;drawInfluenceIcons(influence,x,y)}function drawInfluenceLabels(){var prevX,prevY,minDist;minDist=12;labels.sort(function(a,b){var aPos,bPos,dx,dy;aPos=a.pos;bPos=b.pos;dx=aPos.x-bPos.x;dy=aPos.y-bPos.y;if(dx){return dx}if(dy){return dy}});prevX=0;prevY=0;$.each(labels,function(index,label){var x,y;x=label.pos.x;y=label.pos.y;if(x===prevX&&y-prevY<minDist){y=prevY+minDist}drawInfluenceLabel(label.influence,{x:x,y:y});prevX=x;prevY=y})}function addInfluenceLabel(influence,pos){var mid,odds,oddsY,fx,x,y;mid=Math.floor(minDraws+pos*(maxDraws-minDraws));odds=deck.drawOdds(mid,influence);oddsY=(odds-minValue)/(1-minValue);fx=(mid-minDraws)/(maxDraws-minDraws);x=graphCoord.left+fx*(graphCoord.right-graphCoord.left);y=graphCoord.bottom+oddsY*(graphCoord.top-graphCoord.bottom);labels.push({influence:influence,pos:{x:x,y:y}})}function drawComponentCurves(){var allInfluenceTurns;$.each(influenceTurns,function(index,influenceTurn){drawInfluenceCurve(influenceTurn.influence,minDraws+influenceTurn.turn-1)});allInfluenceTurns=listAllInfluenceTurns();$.each(allInfluenceTurns,function(index,influenceTurn){var pos;pos=(influenceTurn.turn-1)/(maxDraws-minDraws);addInfluenceLabel(influenceTurn.influence,pos)})}function findGraphExtents(){var odds,maxMidLines;minValue=.75;minDraws=7;maxDraws=15;maxMidLines=6;$.each(influenceTurns,function(index,influenceTurn){var draws=influenceTurn.turn+minDraws-1;odds=deck.drawOdds(draws,influenceTurn.influence);if(odds<minValue){minValue=odds}if(draws+4>maxDraws){maxDraws=draws+4}});minValue=(Math.floor(minValue*10)-1)/10;if(minValue<0){minValue=0}verticalMidlineStep=Math.ceil((maxDraws-minDraws)/maxMidLines);horizontalMidlineStep=.1*Math.ceil((1-minValue)*10/maxMidLines)}ctx.fillStyle=graphStyle.textColor;ctx.strokeStyle=graphStyle.textColor;ctx.font=String(fontSize)+"px sans-serif";ctx.lineWidth=2;influenceTurns=listInfluenceTurns();findGraphExtents();drawOutline();addGraphLabels();drawComponentCurves();drawInfluenceLabels()}if(!String.prototype.repeat){String.prototype.repeat=function(count){"use strict";if(this==null){throw new TypeError("can't convert "+this+" to object")}var str=""+this;count=+count;if(count!=count){count=0}if(count<0){throw new RangeError("repeat count must be non-negative")}if(count==Infinity){throw new RangeError("repeat count must be less than infinity")}count=Math.floor(count);if(str.length==0||count==0){return""}if(str.length*count>=1<<28){throw new RangeError("repeat count must not overflow maximum string size")}var rpt="";for(var i=0;i<count;i++){rpt+=str}return rpt}}"use strict";function makeEternalPowerCalculator(params){var calculator=params;calculator.minDraws=7;calculator.maxDraws=17;calculator.cardlibrary=makeEternalCardLibrary(params.cardlist);if(!calculator.iconSize){calculator.iconSize=20}if(!calculator.graphContainer){calculator.graphContainer=calculator.graphDiv}calculator.tableContainer.css("display","none");function generateGraph(deck){var canvas;calculator.graphDiv.empty();canvas=$("<canvas>").addClass("power-graph-canvas").appendTo(calculator.graphDiv);function regenerate(){drawPowerGraph(canvas,calculator.graphStyle,deck)}$("#icon-fire").bind("load",regenerate);$("#icon-time").bind("load",regenerate);$("#icon-justice").bind("load",regenerate);$("#icon-primal").bind("load",regenerate);$("#icon-shadow").bind("load",regenerate);regenerate()}function showGraph(){calculator.tableContainer.css("display","none");calculator.graphContainer.css("display","inline");calculator.tableMenuItem.removeClass("active-menu-item");calculator.graphMenuItem.addClass("active-menu-item")}function showTable(){calculator.tableContainer.css("display","inline");calculator.graphContainer.css("display","none");calculator.tableMenuItem.addClass("active-menu-item");calculator.graphMenuItem.removeClass("active-menu-item")}function appendInfluenceImage(cell,imageFile){$("<img>").addClass("influence-icon").attr("src",imageFile).attr("width",calculator.iconSize).attr("height",calculator.iconSize).appendTo(cell)}function addInfluenceDisplay(cell,influence){var i;if(influence.power>0){cell.text(String(influence.power))}for(i=0;i<influence.fire;i+=1){appendInfluenceImage(cell,"icon-fire.png")}for(i=0;i<influence.time;i+=1){appendInfluenceImage(cell,"icon-time.png")}for(i=0;i<influence.justice;i+=1){appendInfluenceImage(cell,"icon-justice.png")}for(i=0;i<influence.primal;i+=1){appendInfluenceImage(cell,"icon-primal.png")}for(i=0;i<influence.shadow;i+=1){appendInfluenceImage(cell,"icon-shadow.png")}}function generateTableRows(table,deck){var drawCount,text,row,influenceCards;influenceCards=deck.listInfluenceRequirements();row=$("<tr>").addClass("power-table-row-head").appendTo(table);$("<th>").addClass("power-table-head-draws").text("Draws").appendTo(row);for(drawCount=calculator.minDraws;drawCount<=calculator.maxDraws;drawCount+=1){if(drawCount===calculator.minDraws){text="-"}else{text="+"+String(drawCount-calculator.minDraws)}$("<th>").addClass("power-table-head-draw-count").text(text).appendTo(row)}$.each(influenceCards,function(index,influenceCard){var odds,oddsText,influence,cardList,cardPower,th,td;influence=influenceCard[0];cardList=influenceCard[1];cardPower=cardList[0].influenceRequirements[0].power;row=$("<tr>").addClass("power-table-row-body").appendTo(table);th=$("<th>").addClass("power-table-influence").appendTo(row);addInfluenceDisplay(th,influence);for(drawCount=calculator.minDraws;drawCount<=calculator.maxDraws;drawCount+=1){odds=0;odds=deck.drawOdds(drawCount,influence);oddsText=Math.floor(odds*100)+"%";td=$("<td>").addClass("power-table-odds").text(oddsText).appendTo(row);if(drawCount-calculator.minDraws+1<cardPower){td.addClass("power-table-odds-shaded")}}})}function generatePowerSourceText(deck){var div,text;div=calculator.powerSourcesDiv;div.empty();text="";$.each(deck.listPowerInfluenceSources(),function(index,card){var name;name=deck.cardNames[card.id];if(index>0){text=text+", "}text=text+name.replace(/ /g," ")});div.append("Power and influence sources:");$("<br>").appendTo(div);div.append(text)}calculator.generateTable=function(decklist){var deck,table,validText;if(calculator.cardlibrary.makeError){calculator.validationDiv.text(calculator.cardlibrary.makeError).attr("class","validation-error");return}deck=makeEternalDeck(calculator.cardlibrary,decklist);if(deck.makeError){calculator.validationDiv.text(deck.makeError).attr("class","validation-error");return}table=$("<table>").addClass("power-table");generateTableRows(table,deck);generatePowerSourceText(deck);calculator.tableDiv.empty();calculator.tableDiv.append(table);validText=deck.cards.length+" cards";calculator.validationDiv.text(validText).attr("class","validation-success");generateGraph(deck)};calculator.graphMenuItem.bind("click",function(){showGraph()});calculator.tableMenuItem.bind("click",function(){showTable()});showGraph();return calculator}